# antigravity-figma-mcp-study-02

AntigravityとFigma MCPを使って、Webサイトを1ページ丸ごとAIコーディングする流れを記録します。

## デザイン

以下のデザインをお借りしました。

https://www.figma.com/community/file/1156860863353724933

ただし、イラストなどのベクターデータが大量に含まれているため、Figma MCPが返すデータ量が大きくなりすぎる問題があります。

### 画像をプレースホルダー化

そこで、イラストなどの画像部分は空のプレースホルダーフレームに置き換えることにしました。

プレースホルダーフレームに置き換えるプラグインを作って利用しています。  
https://github.com/yuichiroharai-studies/figma-plugin-to-placeholder

## プロジェクト環境・構成

- Windows 11
- Astro
- Tailwind CSS

## AIコーディング環境

- Antigravity
  - モード: Planning
  - モデル:
    - `Gemini 3 Pro(High)`: Figmaデザインを取り込んだ実装を担当
    - `Claude Sonnet 4.5 (Thinking)`: コードの最適化や改善を担当
- Cursor
  - モード: Agent
  - モデル:
    - `Auto`: Antigravityのモデルが利用制限に引っ掛かった場合に使用
- Figma MCP

Figmaデザインを利用してWebデザインを実装する場合は、`Gemini 3 Pro(High)`を必ず使用します。
それ以外のWebデザインの文脈があまり必要ない場合は、`Claude Sonnet 4.5 (Thinking)`やCursorのAIエージェントも併用します。

## 開発履歴

### v0.1.0

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.1.0/

#### 作業内容

- 「[AGENTS.md](AGENTS.md)」と「[FIGMA.md](docs/FIGMA.md)」にルールを追加
- 1ページ丸ごと一気に実装する流れを考える
- Figmaデザインはデスクトップ版、横幅1440pxのものを使用
- Figma MCPからの完全なデータ取得を目指す
  - `get_metadata`と`get_design_context`を使ってメタデータ/デザインコンテキストを取得
  - Figma MCPに何度も大量にアクセスしていると利用制限が掛かってしまうので、ローカルにファイルとして保存
  - データが大きすぎる場合、途中が省略されることがある
    - Figmaのひとつ下の階層のレイヤーをまとめて選択することで、セクションごとに分割したURLを渡せる
    - それでも、一部のセクションはデータが大きすぎて途中が省略されていた
    - 省略された部分は部分的に取得することができるはず
  - AIに完全なデータになるまで粘り強く実行させる
  - 取得したデータは「[docs/figma/](docs/figma/)」に格納
- 実際にAstroサイトとして実装する前に、「React + Tailwind CSS」のデザインコンテキストの中身を確認
  - `whitespace-pre`は邪魔なので一括削除
  - 使われているフォントファミリーとウェイトの種類や使用箇所を一覧化してもらって確認
    - DM_SansやMontserratが使われている箇所はInterに統一しても問題ないと判断
    - `Inter:Medium`のようなウェイトを含むフォントファミリー指定は間違いなので、`Inter`に統一
- 実装計画書を提案してもらう
  - 実装するセクションの順番が分かるように
  - ひとつひとつのセクションの細かい手順が明確になるように
  - `npm run dev`で進捗が分かるように、コンポーネントを作成するたびに`index.astro`に組み込むように
  - 一度にまとめて作業をさせると細かいルールが忘れられやすいので、`AGENTS.md`や`FIGMA.md`を参照するように念押し
- 完成した計画書は「[impl-base-desktop.md](docs/plans/impl-base-desktop.md)」
- 実装開始

#### 考察

- 実装に掛かった時間は12分程度
  - Figma MCPから取得したデータをローカルに保存したおかげで早くなっている
- 初校のモックアップとしてはそこまで悪くない出来栄え
- 画像やアイコンは想定通りにプレースホルダーが使われていた

### v0.1.1

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.1.1/

#### 作業内容

文字校正の流れを考える。

- Figma上でセクションごとにエクスポートしたスクリーンショットを保存
- Gemini APIを使い、スクリーンショットからテキストを抽出する
- 抽出したテキストと実際のコードのテキストを比較させる
- 費用的にも無料枠で問題なさそう

#### 考察

- 今回は、テキスト抽出側で`Whitepace`を`Whitespace`に誤認するミスがあったが、それ以外はすべて一致
- 誤植や文法ミス、`Evernote`という関係ない文字列があること、なども指摘してくれた

### v0.1.2

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.1.2/

#### 作業内容

冗長なスタイル指定を減らしたい。

- 一括で削除したもの
  - `whitespace-pre`
    - 明らかに不要
  - `box-border`
    - Tailwindで初期化済み
  - `content-stretch`, `shrink-0`, `text-nowrap`
    - いったん全削除して、後で必要なものだけ適用しなおす

- AIに判断させて不要なものだけを削除
  - フォントファミリー、フォントウェイト、テキスト色、背景色
    - `global.css`にまとめる
  - 行間
    - Figmaでの初期値は`leading-[normal]`
    - Tailwindでは`1.5`で初期化されているので、`global.css`内で`line-height: normal`で上書き
  - `relative`
    - 子要素で`absolute`や`z-index`の指定がないものを選ぶ

#### 考察

AIに判断させて不要なものを削除させたが、細かいことろで抜けがあったのでレビューは必須。

- 広い対象範囲を一気にやっているので、抜けが多くなってそう
- 実行前の判断やアルゴリズムは正しいが、実際の結果がそうなってない場合などもある
  - WindowsなのでPowerShellの使い方がおかしい場合など
- 「親要素」、「先祖要素」などの用語を使い分けないと齟齬が出てくる

AIモデルの進化によっても変わってくると思うので様子見。

### v0.1.3

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.1.3/

#### 作業内容

青いボタンを共通コンポーネント化した。

- Figma上でコンポーネント化されているのが理想ではあるが、そうなってない場合を想定
- AIに青いボタンが使われている箇所を一覧化し分析してもらう
  - テキストサイズや余白、アイコンの有無など差異のある箇所を調査
  - 差異を無視できそうなところは共通化
  - コンポーネントとしてどこまで共通化できるかを判断
- 分析を元にコンポーネントを実装する
  - 余計なスタイルや不要な入れ子構造は削除
- プレースホルダーだった箇所に実際の画像を適用させる
- ホバーアニメーション
  - デザインで指定がなかったので、簡易的に実装

#### 考察

AIは対象を一覧化したりそこから分析したりするのは得意なので任せる。  
実装にあたっての細かい判断は(今はまだ)自分でした方が早そう。

### v0.2.0

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.2.0/

#### 作業内容

- 全セクションを最大幅1440pxに設定して中央寄せ
- テキスト+画像のような2列のセクションをグリッドアウトに
  - ついでに最適化

#### 考察

グリッドレイアウトのようないくつかのスタイルを組み合わせるタイプは、AIにやらせた方が早い。

```
12列のグリッドレイアウトでギャップは32pxで
画像5列 余白1列 テキスト6列で
```

1つのセクションを手動で更新したら、それを残りのセクションに対してAIが真似するように指示すると効率がいい。

```
A.astroの最適化をB.astro、C.astro、D.astroにも適用して
テキストと画像の順番は変更しないで
列数も変えないで
```

### v0.2.1

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.2.1/

#### 作業内容

Pricing.astroの本格実装。

- 不要なスタイルや冗長な入れ子構造を削除
- 配列のmapでループして要素を生成
- 選択状態によってスタイルを変更、クリックイベントで選択状態を変更
- 選択したら縦に背景が大きくなるトランジション演出

#### 考察

3つのプランが横に並んでいるが、デザインから取り込んだ段階で、真ん中のプランだけ別のスタイルが当たっていた。

```
2番目のプランだけ別のスタイルが当たっているので、`data-selected="true"`を持つかどうかでスタイルを切り替えられるようにして
groupの機能も利用して
```

のような指示でAIにスタイルをマージしてもらった。

3つのプランに同じスタイルが当たったことで、配列のmapでループして要素を生成できるようになった。  
これもAIに指示すれば自動でやってくれる。

ちなみに、

```
青い背景をbefore疑似要素に変更して
```

のような指示もやってくれる。  
これで背景だけTransformでトランジションさせることが可能になった。

### v0.2.2

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.2.2/

#### 作業内容

- 残りのセクションも一気に本格実装
- デスクトップレイアウトで必要な機能はひととおり実装
- 色を変数にするように全体をリファクタリング

#### 考察

- 具体的な実装方法が頭にあるなら、AIへの指示も具体的にした方が失敗が減る
  - 論理さえ破綻しなければ、自然言語の殴り書きでもAIがそれを理解して実装してくれる
- 自分でやった方が早そうなものは、ひとつだけ自分でやって、それをAIに真似させる
- 以下を同時に使った複雑なTailwindのスタイル指定に対して、リファクタリングをさせたらレイアウトが大崩れしたので注意
  - 疑似要素
  - data属性を使った状態管理
  - group
  - トランジション

以下は、なかなか便利だったプロンプト

```
プレースホルダー画像をapp-*.svgに差し替えて
```

Figmaのデザイン上でレイヤー名をちゃんと付けておけばdata-nameに設定されるので、画像のファイル名と関連するものを差し替えてくれる。

```
imgをやめて同じサイズのdivにしてmask-imageして
背景は白にして、ホバーの時は黄色にして
```

色の指定が曖昧でも、他の場所で使われているものを探してくれる。  
変数を使って定義しておけばより確実。

### v0.2.3

https://yuichiroharai-studies.github.io/antigravity-figma-mcp-study-02/0.2.3/

#### 作業内容

プランにホバーした時に中のボタンのスタイルが変わるように修正

#### 考察

前述の通り、プランの要素はスタイル設定が複雑になっているが、AIへの指示だけで上手くいった。

### v0.2.3(バージョン変更はそのまま)

#### 作業内容

いきなり実装するのではなく、モバイル版のFigma MCPのデザインデータを取得し、デスクトップ版との差異を確認する。

- モバイル版のメタデータとJSX(デザインコンテキスト)をファイルに保存
  - デスクトップ版と同様に完全取得できているかに注意
- デスクトップ版と比較してコンテンツやスタイルの違いを把握
  - 1ファイルずつ比較してレポートしてもらい、必要に応じてJSXを修正する
  - デスクトップ版同様の誤植や文法ミスなどを検出

#### 考察

デスクトップ版の時と同じ原稿・文法チェックに加えて、AIがデスクトップ版との整合性を確認してくれる。  
先にJSXを修正しておくことで、AIの実装結果を安定させたい。

### v0.3.0

#### 作業内容

- モバイル版の実装計画を事前に作成
  - 計画書は「[impl-base-mobile.md](docs/plans/impl-base-mobile.md)」
- 既存のページにモバイルレイアウトを組み込む
  - 実装計画とモバイル版のJSXを元にする

#### 考察

- 計画の時点でレイアウトやスタイルがどのように変化するのかを事前に把握している
  - レイアウトの変更は多い(当たり前ですが)
  - スタイルの変更は今回は少なめ
    - 本文のフォントサイズが同じ
    - ボタンのサイズやフォントサイズも同じ
- 負担が比較的少ないのもあって、実装も特に問題なし
- スライダーを使うセクション(2箇所)
  - 構造自体はデスクトップ版のままで、スタイルだけがモバイル版になっている
  - スライダー機能を追加するだけで完成できそう
